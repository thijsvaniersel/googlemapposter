{"version":3,"file":"source.js","sources":["src/mixin/source.js"],"sourcesContent":["import { getSourceId, initializeSource, setSourceId } from '../ol-ext'\nimport { isArray, isEqual, isString } from '../util/minilo'\nimport mergeDescriptors from '../util/multi-merge-descriptors'\nimport cmp from './ol-virt-cmp'\nimport useMapCmp from './use-map-cmp'\n\nexport default {\n  mixins: [cmp, useMapCmp],\n  props: {\n    attributions: {\n      type: [String, Array],\n      validator: value => isString(value) || (isArray(value) && value.every(isString)),\n    },\n    attributionsCollapsible: {\n      type: Boolean,\n      default: true,\n    },\n    projection: String,\n    wrapX: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  computed: {\n    state () {\n      if (!this.rev || !this.$source) {\n        return\n      }\n\n      return this.$source.getState()\n    },\n  },\n  methods: {\n    /**\n     * @return {module:ol/source/Source~Source|Promise<module:ol/source/Source~Source>}\n     * @protected\n     */\n    async createOlObject () {\n      const source = await this.createSource()\n\n      initializeSource(source, this.id)\n\n      return source\n    },\n    /**\n     * @return {module:ol/source/Source~Source|Promise<module:ol/source/Source~Source>}\n     * @protected\n     * @abstract\n     */\n    createSource () {\n      throw new Error('Not implemented method')\n    },\n    /**\n     * @return {Promise|void}\n     * @protected\n     */\n    init () {\n      return this::cmp.methods.init()\n    },\n    /**\n     * @return {Promise|void}\n     * @protected\n     */\n    deinit () {\n      return this::cmp.methods.deinit()\n    },\n    /**\n     * @return {Object}\n     * @protected\n     */\n    getServices () {\n      const vm = this\n\n      return mergeDescriptors(this::cmp.methods.getServices(), {\n        get source () { return vm.$source },\n      })\n    },\n    /**\n     * @return {Promise|void}\n     * @protected\n     */\n    mount () {\n      this.$sourceContainer && this.$sourceContainer.setSource(this)\n\n      return this::cmp.methods.mount()\n    },\n    /**\n     * @return {Promise|void}\n     * @protected\n     */\n    unmount () {\n      this.$sourceContainer && this.$sourceContainer.setSource(undefined)\n\n      return this::cmp.methods.unmount()\n    },\n    /**\n     * @return {Promise}\n     */\n    refresh () {\n      if (!this.$source) return Promise.resolve()\n\n      return new Promise(resolve => {\n        if (this.$source) {\n          this.$source.once('change', () => resolve)\n          this.$source.refresh()\n        } else {\n          resolve()\n        }\n      })\n    },\n    /**\n     * Internal usage only in components that doesn't support refreshing.\n     * @return {Promise}\n     * @protected\n     */\n    remount () {\n      return this::cmp.methods.remount()\n    },\n    /**\n     * Internal usage only in components that doesn't support refreshing.\n     * @return {Promise}\n     * @protected\n     */\n    recreate () {\n      return this::cmp.methods.recreate()\n    },\n    /**\n     * @protected\n     */\n    subscribeAll () {\n      this::cmp.methods.subscribeAll()\n    },\n  },\n  watch: {\n    id (value) {\n      if (!this.$source || value === getSourceId(this.$source)) {\n        return\n      }\n\n      setSourceId(this.$source, value)\n    },\n    attributions (value) {\n      if (!this.$source || isEqual(value, this.$source.getAttributions())) {\n        return\n      }\n\n      this.$source.setAttributions(value)\n    },\n    attributionsCollapsible (value) {\n      if (!this.$source || value === this.$source.getAttributionsCollapsible()) {\n        return\n      }\n\n      this.scheduleRecreate()\n    },\n    projection (value) {\n      if (\n        !this.$source ||\n        (this.$source.getProjection() && value === this.$source.getProjection().getCode())\n      ) {\n        return\n      }\n\n      this.scheduleRecreate()\n    },\n    wrapX (value) {\n      if (!this.$source || value === this.$source.getWrapX()) {\n        return\n      }\n\n      this.scheduleRecreate()\n    },\n  },\n  stubVNode: {\n    empty () {\n      return this.vmId\n    },\n  },\n  created () {\n    this::defineServices()\n  },\n}\n\nfunction defineServices () {\n  Object.defineProperties(this, {\n    /**\n     * @type {module:ol/source/Source~Source|undefined}\n     */\n    $source: {\n      enumerable: true,\n      get: () => this.$olObject,\n    },\n    $map: {\n      enumerable: true,\n      get: () => this.$services && this.$services.map,\n    },\n    $view: {\n      enumerable: true,\n      get: () => this.$services && this.$services.view,\n    },\n    $sourceContainer: {\n      enumerable: true,\n      get: () => this.$services && this.$services.sourceContainer,\n    },\n  })\n}\n"],"names":["mixins","cmp","useMapCmp","props","attributions","type","String","Array","validator","value","isString","isArray","attributionsCollapsible","Boolean","default","projection","wrapX","computed","state","rev","$source","getState","methods","createOlObject","createSource","source","initializeSource","id","Error","init","deinit","getServices","vm","mergeDescriptors","mount","$sourceContainer","setSource","unmount","undefined","refresh","resolve","once","remount","recreate","subscribeAll","watch","getSourceId","setSourceId","isEqual","getAttributions","setAttributions","getAttributionsCollapsible","scheduleRecreate","getProjection","getCode","getWrapX","stubVNode","empty","vmId","created","defineServices","enumerable","get","$olObject","$map","$services","$view","view","sourceContainer"],"mappings":"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"}