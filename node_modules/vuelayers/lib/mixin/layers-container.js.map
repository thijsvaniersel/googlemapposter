{"version":3,"file":"layers-container.js","sources":["src/mixin/layers-container.js"],"sourcesContent":["import Collection from 'ol/Collection'\nimport BaseLayer from 'ol/layer/Base'\nimport Vue from 'vue'\nimport { merge as mergeObs } from 'rxjs/observable'\nimport { getLayerId, initializeLayer } from '../ol-ext'\nimport { observableFromOlEvent } from '../rx-ext'\nimport { instanceOf } from '../util/assert'\nimport rxSubs from './rx-subs'\nimport identMap from './ident-map'\n\nexport default {\n  mixins: [identMap, rxSubs],\n  computed: {\n    layerIds () {\n      if (!this.rev) return []\n\n      return this.getLayers().map(getLayerId)\n    },\n    layersCollectionIdent () {\n      if (!this.olObjIdent) return\n\n      return this.makeIdent(this.olObjIdent, 'layers_collection')\n    },\n  },\n  methods: {\n    /**\n     * @param {BaseLayer|Vue} layer\n     * @return {void}\n     */\n    addLayer (layer) {\n      layer = layer instanceof Vue ? layer.$layer : layer\n      instanceOf(layer, BaseLayer)\n\n      if (this.getLayerById(getLayerId(layer)) == null) {\n        initializeLayer(layer)\n        this.$layersCollection.push(layer)\n      }\n    },\n    /**\n     * @param {BaseLayer|Vue} layer\n     * @return {void}\n     */\n    removeLayer (layer) {\n      layer = this.getLayerById(getLayerId(layer))\n      if (!layer) return\n\n      this.$layersCollection.remove(layer)\n    },\n    /**\n     * @return {BaseLayer[]}\n     */\n    getLayers () {\n      return this.$layersCollection.getArray()\n    },\n    /**\n     * @return {module:ol/Collection~Collection<BaseLayer>}\n     */\n    getLayersCollection () {\n      return this._layersCollection\n    },\n    /**\n     * @param {string|number} layerId\n     * @return {BaseLayer|undefined}\n     */\n    getLayerById (layerId) {\n      return this.$layersCollection.getArray().find(layer => {\n        return getLayerId(layer) === layerId\n      })\n    },\n    /**\n     * @return {void}\n     */\n    clearLayers () {\n      this.$layersCollection.clear()\n    },\n    /**\n     * @returns {Object}\n     * @protected\n     */\n    getServices () {\n      const vm = this\n\n      return {\n        get layersContainer () { return vm },\n      }\n    },\n  },\n  created () {\n    this._layersCollection = this.instanceFactoryCall(this.layersCollectionIdent, () => new Collection())\n\n    this::defineServices()\n    this::subscribeToCollectionEvents()\n  },\n}\n\nfunction defineServices () {\n  Object.defineProperties(this, {\n    $layersCollection: {\n      enumerable: true,\n      get: this.getLayersCollection,\n    },\n  })\n}\n\nfunction subscribeToCollectionEvents () {\n  const adds = observableFromOlEvent(this.$layersCollection, 'add')\n  const removes = observableFromOlEvent(this.$layersCollection, 'remove')\n\n  this.subscribeTo(mergeObs(adds, removes), ({ type, element }) => {\n    ++this.rev\n\n    this.$nextTick(() => {\n      this.$emit(type + ':layer', element)\n    })\n  })\n}\n"],"names":["mixins","identMap","rxSubs","computed","layerIds","rev","getLayers","getLayerId","layersCollectionIdent","olObjIdent","makeIdent","methods","addLayer","layer","Vue","$layer","instanceOf","BaseLayer","getLayerById","initializeLayer","$layersCollection","push","removeLayer","remove","getArray","getLayersCollection","_layersCollection","layerId","clearLayers","clear","getServices","vm","layersContainer","created","instanceFactoryCall","Collection","defineServices","subscribeToCollectionEvents","enumerable","get","adds","observableFromOlEvent","removes","subscribeTo","mergeObs","type","element","$nextTick","$emit"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAUA,sBAAe;EACbA,MAAM,EAAE,CAACC,QAAD,EAAWC,MAAX,CADK;EAEbC,QAAQ,EAAE;IACRC,QADQ,sBACI;;;UACN,CAAC,KAAKC,GAAV,EAAe,OAAO,EAAP;aAER,qCAAKC,SAAL,mBAAqBC,UAArB,CAAP;KAJM;IAMRC,qBANQ,mCAMiB;UACnB,CAAC,KAAKC,UAAV,EAAsB;aAEf,KAAKC,SAAL,CAAe,KAAKD,UAApB,EAAgC,mBAAhC,CAAP;;GAXS;EAcbE,OAAO,EAAE;;;;;IAKPC,QALO,oBAKGC,KALH,EAKU;MACfA,KAAK,GAAGA,KAAK,YAAYC,GAAjB,GAAuBD,KAAK,CAACE,MAA7B,GAAsCF,KAA9C;MACAG,UAAU,CAACH,KAAD,EAAQI,SAAR,CAAV;;UAEI,KAAKC,YAAL,CAAkBX,UAAU,CAACM,KAAD,CAA5B,KAAwC,IAA5C,EAAkD;QAChDM,eAAe,CAACN,KAAD,CAAf;aACKO,iBAAL,CAAuBC,IAAvB,CAA4BR,KAA5B;;KAXG;;;;;;IAkBPS,WAlBO,uBAkBMT,KAlBN,EAkBa;MAClBA,KAAK,GAAG,KAAKK,YAAL,CAAkBX,UAAU,CAACM,KAAD,CAA5B,CAAR;UACI,CAACA,KAAL,EAAY;WAEPO,iBAAL,CAAuBG,MAAvB,CAA8BV,KAA9B;KAtBK;;;;;IA2BPP,SA3BO,uBA2BM;aACJ,KAAKc,iBAAL,CAAuBI,QAAvB,EAAP;KA5BK;;;;;IAiCPC,mBAjCO,iCAiCgB;aACd,KAAKC,iBAAZ;KAlCK;;;;;;IAwCPR,YAxCO,wBAwCOS,OAxCP,EAwCgB;;;aACd,uCAAKP,iBAAL,CAAuBI,QAAvB,oBAAuC,UAAAX,KAAK,EAAI;eAC9CN,UAAU,CAACM,KAAD,CAAV,KAAsBc,OAA7B;OADK,CAAP;KAzCK;;;;;IAgDPC,WAhDO,yBAgDQ;WACRR,iBAAL,CAAuBS,KAAvB;KAjDK;;;;;;IAuDPC,WAvDO,yBAuDQ;UACPC,EAAE,GAAG,IAAX;aAEO;YACDC,eAAJ,GAAuB;iBAASD,EAAP;;;OAD3B;;GAxES;EA6EbE,OA7Ea,qBA6EF;SACJP,iBAAL,GAAyB,KAAKQ,mBAAL,CAAyB,KAAK1B,qBAA9B,EAAqD;aAAM,IAAI2B,UAAJ,EAAN;KAArD,CAAzB;IAEMC,cAAN;IACMC,2BAAN;;CAjFJ;;AAqFA,SAASD,cAAT,GAA2B;2BACD,IAAxB,EAA8B;IAC5BhB,iBAAiB,EAAE;MACjBkB,UAAU,EAAE,IADK;MAEjBC,GAAG,EAAE,KAAKd;;GAHd;;;AAQF,SAASY,2BAAT,GAAwC;;;MAChCG,IAAI,GAAGC,qBAAqB,CAAC,KAAKrB,iBAAN,EAAyB,KAAzB,CAAlC;MACMsB,OAAO,GAAGD,qBAAqB,CAAC,KAAKrB,iBAAN,EAAyB,QAAzB,CAArC;OAEKuB,WAAL,CAAiBC,KAAQ,CAACJ,IAAD,EAAOE,OAAP,CAAzB,EAA0C,gBAAuB;QAApBG,IAAoB,QAApBA,IAAoB;QAAdC,OAAc,QAAdA,OAAc;MAC7D,KAAI,CAACzC,GAAP;;IAEA,KAAI,CAAC0C,SAAL,CAAe,YAAM;MACnB,KAAI,CAACC,KAAL,CAAWH,IAAI,GAAG,QAAlB,EAA4BC,OAA5B;KADF;GAHF;;;;;"}