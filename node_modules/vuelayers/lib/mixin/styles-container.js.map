{"version":3,"file":"styles-container.js","sources":["src/mixin/styles-container.js"],"sourcesContent":["import Vue from 'vue'\nimport { Style } from 'ol/style'\nimport { warn } from '../util/log'\nimport { isFunction, reduce } from '../util/minilo'\n\nexport default {\n  created () {\n    /**\n     * @type {module:ol/style/Style~Style[]|module:ol/style/Style~StyleFunction|Vue|undefined}\n     * @private\n     */\n    this._styles = undefined\n  },\n  methods: {\n    /**\n     * Default style factory\n     * @return {module:ol/style/Style~Style[]|module:ol/style/Style~StyleFunction|undefined}\n     * @protected\n     */\n    getDefaultStyles () {},\n    /**\n     * @returns {Object}\n     * @protected\n     */\n    getServices () {\n      const vm = this\n\n      return {\n        get stylesContainer () { return vm },\n      }\n    },\n    /**\n     * @return {module:ol/style/Style~Style[]|module:ol/style/Style~StyleFunction|Vue|undefined}\n     */\n    getStyles () {\n      return this._styles\n    },\n    /**\n     * @param {module:ol/style/Style~Style|module:ol/style/Style~StyleFunction|Vue|undefined} style\n     * @return {void}\n     */\n    addStyle (style) {\n      let currentStyles = this.getStyles()\n      let olStyle = style instanceof Vue ? style.$style : style\n\n      if (isFunction(olStyle)) {\n        if (process.env.NODE_ENV !== 'production' && currentStyles) {\n          warn('Component already has style components among it\\'s descendants. ' +\n            'Avoid use of multiple vl-style-func or combining vl-style-func with vl-style-box on the same level')\n        }\n        currentStyles = style\n      } else {\n        if (!Array.isArray(currentStyles)) {\n          if (process.env.NODE_ENV !== 'production' && currentStyles) {\n            warn('Component already has style components among it\\'s descendants. ' +\n              'Avoid use of multiple vl-style-func or combining vl-style-func with vl-style-box on the same level')\n          }\n          currentStyles = []\n        }\n        style = style instanceof Vue ? style : { $style: style, condition: true }\n        if (!currentStyles.includes(style)) {\n          currentStyles.push(style)\n        }\n      }\n\n      this.setStyle(currentStyles)\n    },\n    /**\n     * @param {Array<{style: module:ol/style/Style~Style, condition: (function|boolean|undefined)}>|module:ol/style/Style~StyleFunction|Vue|undefined} styles\n     * @return {void}\n     */\n    setStyle (styles) {\n      if (styles === this._styles) return\n      this._styles = styles\n\n      const styleTarget = this.getStyleTarget()\n      if (!styleTarget) return\n\n      if (this._styles === null || this._styles) {\n        styleTarget.setStyle(this.createStyleFunc())\n      } else {\n        styleTarget.setStyle(undefined)\n      }\n    },\n    /**\n     * @param {module:ol/style/Style~Style|module:ol/style/Style~StyleFunction|Vue|undefined} style\n     * @return {void}\n     */\n    removeStyle (style) {\n      let currentStyles = this.getStyles()\n\n      if (currentStyles === style) {\n        currentStyles = undefined\n      } else if (Array.isArray(currentStyles)) {\n        currentStyles = currentStyles.filter(s => {\n          return style instanceof Vue\n            ? s !== style\n            : s.$style !== style\n        })\n        currentStyles.length || (currentStyles = undefined)\n      }\n\n      this.setStyle(currentStyles)\n    },\n    /**\n     * Returns OL object that can be styled (i.e. has setStyle/getStyle methods) or undefined\n     * @return {*}\n     * @protected\n     * @abstract\n     */\n    getStyleTarget () {\n      throw new Error('Not implemented method')\n    },\n    /**\n     * Style function factory\n     * @returns {module:ol/style/Style~StyleFunction}\n     * @protected\n     */\n    createStyleFunc () {\n      const vm = this\n      const defaultStyles = this.getDefaultStyles()\n\n      return function __styleTargetStyleFunc (feature, resolution) {\n        if (!feature.getGeometry()) return\n        let styles = vm.getStyles()\n        /* eslint-disable brace-style */\n        // handle provided styles\n        // styles - StyleFunction or vl-style-func\n        if (styles && (isFunction(styles) || isFunction(styles.$style))) {\n          let styleFunc = isFunction(styles) ? styles : styles.$style\n          styles = styleFunc(feature, resolution)\n        }\n        // styles is array of { $style: Style, condition: (bool|function():bool) }\n        else if (Array.isArray(styles)) {\n          styles = reduce(styles, (newStyles, { $style, condition }) => {\n            if (\n              condition == null ||\n              (condition === true) ||\n              (\n                isFunction(condition) &&\n                condition(feature, resolution)\n              )\n            ) {\n              newStyles.push($style)\n            }\n            return newStyles\n          }, [])\n        }\n        /* eslint-enable brace-style */\n        // not empty or null style\n        if (\n          styles === null ||\n          (Array.isArray(styles) && styles.length) ||\n          styles instanceof Style\n        ) {\n          return styles\n        }\n        // fallback to default style\n        styles = defaultStyles\n        if (styles) {\n          return isFunction(styles)\n            ? styles(feature, resolution)\n            : styles\n        }\n      }\n    },\n  },\n}\n"],"names":["created","_styles","undefined","methods","getDefaultStyles","getServices","vm","stylesContainer","getStyles","addStyle","style","currentStyles","olStyle","Vue","$style","isFunction","process","env","NODE_ENV","warn","condition","push","setStyle","styles","styleTarget","getStyleTarget","createStyleFunc","removeStyle","s","length","Error","defaultStyles","__styleTargetStyleFunc","feature","resolution","getGeometry","styleFunc","reduce","newStyles","Style"],"mappings":"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"}