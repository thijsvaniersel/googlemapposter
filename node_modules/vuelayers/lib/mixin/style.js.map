{"version":3,"file":"style.js","sources":["src/mixin/style.js"],"sourcesContent":["import { first as firstObs } from 'rxjs/operators'\nimport { getStyleId, initializeStyle, setStyleId } from '../ol-ext'\nimport { observableFromOlEvent } from '../rx-ext'\nimport mergeDescriptors from '../util/multi-merge-descriptors'\nimport cmp from './ol-virt-cmp'\nimport useMapCmp from './use-map-cmp'\n\n/**\n * Basic style mixin.\n */\nexport default {\n  mixins: [cmp, useMapCmp],\n  methods: {\n    /**\n     * @return {OlStyle|Promise<OlStyle>}\n     * @protected\n     */\n    async createOlObject () {\n      const style = await this.createStyle()\n\n      initializeStyle(style)\n\n      return style\n    },\n    /**\n     * @return {OlStyle|Promise<OlStyle>}\n     * @protected\n     * @abstract\n     */\n    createStyle () {\n      throw new Error('Not implemented method')\n    },\n    /**\n     * @return {Promise}\n     * @protected\n     */\n    init () {\n      return this::cmp.methods.init()\n    },\n    /**\n     * @return {void|Promise<void>}\n     * @protected\n     */\n    deinit () {\n      return this::cmp.methods.deinit()\n    },\n    /**\n     * @return {Object}\n     * @protected\n     */\n    getServices () {\n      const vm = this\n\n      return mergeDescriptors(this::cmp.methods.getServices(), {\n        get style () { return vm.$style },\n      })\n    },\n    /**\n     * @return {Promise}\n     */\n    refresh () {\n      if (this.$olObject == null) return Promise.resolve()\n\n      return this.remount()\n        .then(() => {\n          if (!this.$map) {\n            return\n          }\n\n          this.$map.render()\n\n          return observableFromOlEvent(this.$map, 'postcompose')\n            .pipe(firstObs())\n            .toPromise()\n        })\n    },\n  },\n  stubVNode: {\n    empty () {\n      return this.vmId\n    },\n  },\n  created () {\n    this::defineServices()\n  },\n  watch: {\n    id (value) {\n      if (!this.$style || value === getStyleId(this.$style)) {\n        return\n      }\n\n      setStyleId(this.$style, value)\n    },\n  },\n}\n\nfunction defineServices () {\n  Object.defineProperties(this, {\n    $style: {\n      enumerable: true,\n      get: () => this.$olObject,\n    },\n    $map: {\n      enumerable: true,\n      get: () => this.$services && this.$services.map,\n    },\n    $view: {\n      enumerable: true,\n      get: () => this.$services && this.$services.view,\n    },\n    $stylesContainer: {\n      enumerable: true,\n      get: () => this.$services && this.$services.stylesContainer,\n    },\n  })\n}\n"],"names":["mixins","cmp","useMapCmp","methods","createOlObject","createStyle","style","initializeStyle","Error","init","deinit","getServices","vm","mergeDescriptors","$style","refresh","$olObject","resolve","remount","then","$map","render","observableFromOlEvent","pipe","firstObs","toPromise","stubVNode","empty","vmId","created","defineServices","watch","id","value","getStyleId","setStyleId","enumerable","get","$services","$view","view","$stylesContainer","stylesContainer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAOA;;;;AAGA,YAAe;EACbA,MAAM,EAAE,CAACC,GAAD,EAAMC,SAAN,CADK;EAEbC,OAAO,EAAE;;;;;IAKDC,cALC,4BAKiB;;;;;;;;;;uBACF,KAAI,CAACC,WAAL,EADE;;;gBAChBC,KADgB;gBAGtBC,eAAe,CAACD,KAAD,CAAf;iDAEOA,KALe;;;;;;;;;KALjB;;;;;;;IAiBPD,WAjBO,yBAiBQ;YACP,IAAIG,KAAJ,CAAU,wBAAV,CAAN;KAlBK;;;;;;IAwBPC,IAxBO,kBAwBC;aACOR,GAAG,CAACE,OAAJ,CAAYM,IAAlB,WAAP;KAzBK;;;;;;IA+BPC,MA/BO,oBA+BG;aACKT,GAAG,CAACE,OAAJ,CAAYO,MAAlB,WAAP;KAhCK;;;;;;IAsCPC,WAtCO,yBAsCQ;UACPC,EAAE,GAAG,IAAX;aAEOC,gBAAgB,CAAOZ,GAAG,CAACE,OAAJ,CAAYQ,WAAlB,WAAD,EAAkC;YACnDL,KAAJ,GAAa;iBAASM,EAAE,CAACE,MAAV;;;OADM,CAAvB;KAzCK;;;;;IAgDPC,OAhDO,qBAgDI;;;UACL,KAAKC,SAAL,IAAkB,IAAtB,EAA4B,OAAO,SAAQC,OAAR,EAAP;aAErB,KAAKC,OAAL,GACJC,IADI,CACC,YAAM;YACN,CAAC,MAAI,CAACC,IAAV,EAAgB;;;;QAIhB,MAAI,CAACA,IAAL,CAAUC,MAAV;;eAEOC,qBAAqB,CAAC,MAAI,CAACF,IAAN,EAAY,aAAZ,CAArB,CACJG,IADI,CACCC,KAAQ,EADT,EAEJC,SAFI,EAAP;OARG,CAAP;;GArDS;EAmEbC,SAAS,EAAE;IACTC,KADS,mBACA;aACA,KAAKC,IAAZ;;GArES;EAwEbC,OAxEa,qBAwEF;IACHC,cAAN;GAzEW;EA2EbC,KAAK,EAAE;IACLC,EADK,cACDC,KADC,EACM;UACL,CAAC,KAAKnB,MAAN,IAAgBmB,KAAK,KAAKC,UAAU,CAAC,KAAKpB,MAAN,CAAxC,EAAuD;;;;MAIvDqB,UAAU,CAAC,KAAKrB,MAAN,EAAcmB,KAAd,CAAV;;;CAjFN;;AAsFA,SAASH,cAAT,GAA2B;;;2BACD,IAAxB,EAA8B;IAC5BhB,MAAM,EAAE;MACNsB,UAAU,EAAE,IADN;MAENC,GAAG,EAAE;eAAM,MAAI,CAACrB,SAAX;;KAHqB;IAK5BI,IAAI,EAAE;MACJgB,UAAU,EAAE,IADR;MAEJC,GAAG,EAAE;eAAM,MAAI,CAACC,SAAL,yBAAkB,MAAI,CAACA,SAAvB,CAAN;;KAPqB;IAS5BC,KAAK,EAAE;MACLH,UAAU,EAAE,IADP;MAELC,GAAG,EAAE;eAAM,MAAI,CAACC,SAAL,IAAkB,MAAI,CAACA,SAAL,CAAeE,IAAvC;;KAXqB;IAa5BC,gBAAgB,EAAE;MAChBL,UAAU,EAAE,IADI;MAEhBC,GAAG,EAAE;eAAM,MAAI,CAACC,SAAL,IAAkB,MAAI,CAACA,SAAL,CAAeI,eAAvC;;;GAfT;;;;;"}