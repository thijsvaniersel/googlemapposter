{"version":3,"file":"index.js","sources":["src/component/geoloc/geoloc.vue?rollup-plugin-vue=script.js","src/component/geoloc/geoloc.vue","src/component/geoloc/index.js"],"sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n\nimport Geolocation from 'ol/Geolocation'\nimport { merge } from 'rxjs/observable'\nimport { olCmp, useMapCmp, projTransforms } from '../../mixin'\nimport { observableFromOlChangeEvent } from '../../rx-ext'\nimport { hasGeolocation } from '../../util/assert'\nimport { isEqual } from '../../util/minilo'\n\nexport default {\n  name: 'vl-geoloc',\n  mixins: [olCmp, useMapCmp, projTransforms],\n  props: {\n    tracking: {\n      type: Boolean,\n      default: true,\n    },\n    trackingOptions: Object,\n    /**\n     * @type {string}\n     */\n    projection: String,\n  },\n  computed: {\n    accuracy () {\n      if (this.rev && this.$geolocation) {\n        return this.$geolocation.getAccuracy()\n      }\n    },\n    altitude () {\n      if (this.rev && this.$geolocation) {\n        return this.$geolocation.getAltitude()\n      }\n    },\n    altitudeAccuracy () {\n      if (this.rev && this.$geolocation) {\n        return this.$geolocation.getAltitudeAccuracy()\n      }\n    },\n    heading () {\n      if (this.rev && this.$geolocation) {\n        return this.$geolocation.getHeading()\n      }\n    },\n    speed () {\n      if (this.rev && this.$geolocation) {\n        return this.$geolocation.getSpeed()\n      }\n    },\n    position () {\n      if (this.rev && this.$geolocation) {\n        return this.$geolocation.getPosition()\n      }\n    },\n    positionViewProj () {\n      if (this.position && this.viewProjection) {\n        return this.pointToViewProj(this.position)\n      }\n    },\n  },\n  methods: {\n    /**\n     * @return {ol/Geolocation~Geolocation}\n     * @private\n     */\n    createOlObject () {\n      const geoloc = new Geolocation({\n        tracking: this.tracking,\n        trackingOptions: this.trackingOptions,\n        projection: this.resolvedDataProjection,\n      })\n\n      geoloc.set('id', this.id)\n\n      return geoloc\n    },\n    /**\n     * @return {void}\n     * @private\n     */\n    mount () {\n      this.subscribeAll()\n    },\n    /**\n     * @return {void}\n     * @private\n     */\n    unmount () {\n      hasGeolocation(this)\n\n      this.unsubscribeAll()\n      this.$geolocation.setTracking(false)\n    },\n    /**\n     * @return {void}\n     * @protected\n     */\n    subscribeAll () {\n      this::subscribeToGeolocation()\n    },\n  },\n  watch: {\n    id (value) {\n      if (!this.$geolocation || value === this.geolocation.get('id')) {\n        return\n      }\n\n      this.$geolocation.set('id', value)\n    },\n    /**\n     * @param {boolean} value\n     */\n    tracking (value) {\n      if (!this.$geolocation && value === this.$geolocation.getTracking()) {\n        return\n      }\n\n      this.$geolocation.setTracking(value)\n    },\n    tracingOptions (value, prevValue) {\n      if (isEqual(value, prevValue) || !this.$geolocation) return\n\n      this.$geolocation.setTrackingOptions(value)\n    },\n    resolvedDataProjection (value) {\n      if (!this.$geolocation) return\n\n      this.$geolocation.setProjection(value)\n    },\n  },\n  stubVNode: {\n    empty () {\n      return this.vmId\n    },\n  },\n  created () {\n    this::defineServices()\n  },\n}\n\nfunction defineServices () {\n  Object.defineProperties(this, {\n    /**\n     * @type {ol/Geolocation~Geolocation|undefined}\n     */\n    $geolocation: {\n      enumerable: true,\n      get: () => this.$olObject,\n    },\n    $map: {\n      enumerable: true,\n      get: () => this.$services && this.$services.map,\n    },\n    /**\n     * Reference to `ol.View` instance.\n     * @type {module:ol/View~View|undefined}\n     */\n    $view: {\n      enumerable: true,\n      get: () => this.$services && this.$services.view,\n    },\n  })\n}\n\n/**\n * @return {void}\n * @private\n */\nfunction subscribeToGeolocation () {\n  hasGeolocation(this)\n\n  const ft = 1000 / 60\n  const changes = merge(\n    observableFromOlChangeEvent(\n      this.$geolocation,\n      [\n        'accuracy',\n        'altitude',\n        'altitudeaccuracy',\n        'heading',\n        'speed',\n      ],\n      true,\n      ft,\n    ),\n    observableFromOlChangeEvent(\n      this.$geolocation,\n      'position',\n      true,\n      ft,\n    ),\n  )\n\n  this.subscribeTo(changes, ({ prop, value }) => {\n    ++this.rev\n\n    this.$nextTick(() => {\n      this.$emit(`update:${prop}`, value)\n    })\n  })\n}\n","<template>\n  <i :id=\"vmId\" :class=\"cmpName\" style=\"display: none !important;\">\n    <slot :accuracy=\"accuracy\" :altitude=\"altitude\" :altitude-accuracy=\"altitudeAccuracy\"\n          :heading=\"heading\" :position=\"position\" :speed=\"speed\">\n    </slot>\n  </i>\n</template>\n\n<script>\n  import Geolocation from 'ol/Geolocation'\n  import { merge } from 'rxjs/observable'\n  import { olCmp, useMapCmp, projTransforms } from '../../mixin'\n  import { observableFromOlChangeEvent } from '../../rx-ext'\n  import { hasGeolocation } from '../../util/assert'\n  import { isEqual } from '../../util/minilo'\n\n  export default {\n    name: 'vl-geoloc',\n    mixins: [olCmp, useMapCmp, projTransforms],\n    props: {\n      tracking: {\n        type: Boolean,\n        default: true,\n      },\n      trackingOptions: Object,\n      /**\n       * @type {string}\n       */\n      projection: String,\n    },\n    computed: {\n      accuracy () {\n        if (this.rev && this.$geolocation) {\n          return this.$geolocation.getAccuracy()\n        }\n      },\n      altitude () {\n        if (this.rev && this.$geolocation) {\n          return this.$geolocation.getAltitude()\n        }\n      },\n      altitudeAccuracy () {\n        if (this.rev && this.$geolocation) {\n          return this.$geolocation.getAltitudeAccuracy()\n        }\n      },\n      heading () {\n        if (this.rev && this.$geolocation) {\n          return this.$geolocation.getHeading()\n        }\n      },\n      speed () {\n        if (this.rev && this.$geolocation) {\n          return this.$geolocation.getSpeed()\n        }\n      },\n      position () {\n        if (this.rev && this.$geolocation) {\n          return this.$geolocation.getPosition()\n        }\n      },\n      positionViewProj () {\n        if (this.position && this.viewProjection) {\n          return this.pointToViewProj(this.position)\n        }\n      },\n    },\n    methods: {\n      /**\n       * @return {ol/Geolocation~Geolocation}\n       * @private\n       */\n      createOlObject () {\n        const geoloc = new Geolocation({\n          tracking: this.tracking,\n          trackingOptions: this.trackingOptions,\n          projection: this.resolvedDataProjection,\n        })\n\n        geoloc.set('id', this.id)\n\n        return geoloc\n      },\n      /**\n       * @return {void}\n       * @private\n       */\n      mount () {\n        this.subscribeAll()\n      },\n      /**\n       * @return {void}\n       * @private\n       */\n      unmount () {\n        hasGeolocation(this)\n\n        this.unsubscribeAll()\n        this.$geolocation.setTracking(false)\n      },\n      /**\n       * @return {void}\n       * @protected\n       */\n      subscribeAll () {\n        this::subscribeToGeolocation()\n      },\n    },\n    watch: {\n      id (value) {\n        if (!this.$geolocation || value === this.geolocation.get('id')) {\n          return\n        }\n\n        this.$geolocation.set('id', value)\n      },\n      /**\n       * @param {boolean} value\n       */\n      tracking (value) {\n        if (!this.$geolocation && value === this.$geolocation.getTracking()) {\n          return\n        }\n\n        this.$geolocation.setTracking(value)\n      },\n      tracingOptions (value, prevValue) {\n        if (isEqual(value, prevValue) || !this.$geolocation) return\n\n        this.$geolocation.setTrackingOptions(value)\n      },\n      resolvedDataProjection (value) {\n        if (!this.$geolocation) return\n\n        this.$geolocation.setProjection(value)\n      },\n    },\n    stubVNode: {\n      empty () {\n        return this.vmId\n      },\n    },\n    created () {\n      this::defineServices()\n    },\n  }\n\n  function defineServices () {\n    Object.defineProperties(this, {\n      /**\n       * @type {ol/Geolocation~Geolocation|undefined}\n       */\n      $geolocation: {\n        enumerable: true,\n        get: () => this.$olObject,\n      },\n      $map: {\n        enumerable: true,\n        get: () => this.$services && this.$services.map,\n      },\n      /**\n       * Reference to `ol.View` instance.\n       * @type {module:ol/View~View|undefined}\n       */\n      $view: {\n        enumerable: true,\n        get: () => this.$services && this.$services.view,\n      },\n    })\n  }\n\n  /**\n   * @return {void}\n   * @private\n   */\n  function subscribeToGeolocation () {\n    hasGeolocation(this)\n\n    const ft = 1000 / 60\n    const changes = merge(\n      observableFromOlChangeEvent(\n        this.$geolocation,\n        [\n          'accuracy',\n          'altitude',\n          'altitudeaccuracy',\n          'heading',\n          'speed',\n        ],\n        true,\n        ft,\n      ),\n      observableFromOlChangeEvent(\n        this.$geolocation,\n        'position',\n        true,\n        ft,\n      ),\n    )\n\n    this.subscribeTo(changes, ({ prop, value }) => {\n      ++this.rev\n\n      this.$nextTick(() => {\n        this.$emit(`update:${prop}`, value)\n      })\n    })\n  }\n</script>\n","import { pick } from '../../util/minilo'\nimport Geoloc from './geoloc.vue'\n\nfunction plugin (Vue, options = {}) {\n  if (plugin.installed) {\n    return\n  }\n  plugin.installed = true\n\n  options = pick(options, 'dataProjection')\n  Object.assign(Geoloc, options)\n\n  Vue.component(Geoloc.name, Geoloc)\n}\n\nexport default plugin\n\nexport {\n  Geoloc,\n  plugin as install,\n}\n"],"names":["name","mixins","olCmp","useMapCmp","projTransforms","props","tracking","type","Boolean","default","trackingOptions","Object","projection","String","computed","accuracy","rev","$geolocation","getAccuracy","altitude","getAltitude","altitudeAccuracy","getAltitudeAccuracy","heading","getHeading","speed","getSpeed","position","getPosition","positionViewProj","viewProjection","pointToViewProj","methods","createOlObject","geoloc","Geolocation","resolvedDataProjection","set","id","mount","subscribeAll","unmount","hasGeolocation","unsubscribeAll","setTracking","subscribeToGeolocation","watch","value","geolocation","get","getTracking","tracingOptions","prevValue","isEqual","setTrackingOptions","setProjection","stubVNode","empty","vmId","created","defineServices","enumerable","$olObject","$map","$services","$view","view","ft","changes","merge","observableFromOlChangeEvent","subscribeTo","prop","$nextTick","$emit","plugin","Vue","options","installed","pick","Geoloc","component"],"mappings":"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"}