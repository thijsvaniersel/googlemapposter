{"version":3,"file":"format.js","sources":["src/ol-ext/format.js"],"sourcesContent":["import BaseGeoJSON from 'ol/format/GeoJSON'\nimport MVT from 'ol/format/MVT'\nimport TopoJSON from 'ol/format/TopoJSON'\nimport { isEmpty } from '../util/minilo'\nimport { EPSG_4326 } from './consts'\nimport { createCircularPolygon } from './geom'\nimport { transformPoint } from './proj'\nimport { isCircle } from './util'\nimport LineString from 'ol/geom/LineString'\nimport { getLength } from 'ol/sphere'\n\n/**\n * @param {Object} [options]\n * @return {GeoJSON}\n */\nexport function createGeoJsonFmt (options) {\n  return new GeoJSON(options)\n}\n\n/**\n * @param {Object} [options]\n * @return {TopoJSON}\n */\nexport function createTopoJsonFmt (options) {\n  return new TopoJSON(options)\n}\n\n/**\n * @param [options]\n * @return {MVT}\n */\nexport function createMvtFmt (options) {\n  return new MVT(options)\n}\n\nclass GeoJSON extends BaseGeoJSON {\n  writeGeometryObject (geometry, options) {\n    if (isCircle(geometry)) {\n      const start = geometry.getCenter()\n      const end = [start[0] + geometry.getRadius(), start[1]]\n      const radius = getLength(new LineString([start, end]), options.featureProjection || this.defaultFeatureProjection)\n      geometry = createCircularPolygon(\n        transformPoint(\n          geometry.getCenter(),\n          options.featureProjection || this.defaultFeatureProjection,\n          EPSG_4326,\n        ),\n        radius\n      )\n      options.featureProjection = EPSG_4326\n    }\n    return super.writeGeometryObject(geometry, options)\n  }\n\n  writeFeatureObject (feature, options) {\n    const object = /** @type {Object} */ ({\n      'type': 'Feature',\n    })\n    const id = feature.getId()\n    if (id !== undefined) {\n      object.id = id\n    }\n    const geometry = feature.getGeometry()\n    if (geometry) {\n      object.geometry = this.writeGeometryObject(geometry, options)\n    } else {\n      object.geometry = null\n    }\n    const properties = feature.getProperties()\n    delete properties[feature.getGeometryName()]\n    if (!isEmpty(properties)) {\n      object.properties = properties\n    } else {\n      object.properties = null\n    }\n    return object\n  }\n}\n"],"names":["createGeoJsonFmt","options","GeoJSON","createTopoJsonFmt","TopoJSON","createMvtFmt","MVT","geometry","isCircle","start","getCenter","end","getRadius","radius","getLength","LineString","featureProjection","defaultFeatureProjection","createCircularPolygon","transformPoint","EPSG_4326","feature","object","id","getId","undefined","getGeometry","writeGeometryObject","properties","getProperties","getGeometryName","isEmpty","BaseGeoJSON"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWA;;;;;AAIA,AAAO,SAASA,gBAAT,CAA2BC,OAA3B,EAAoC;SAClC,IAAIC,OAAJ,CAAYD,OAAZ,CAAP;;;;;;;AAOF,AAAO,SAASE,iBAAT,CAA4BF,OAA5B,EAAqC;SACnC,IAAIG,QAAJ,CAAaH,OAAb,CAAP;;;;;;;AAOF,AAAO,SAASI,YAAT,CAAuBJ,OAAvB,EAAgC;SAC9B,IAAIK,GAAJ,CAAQL,OAAR,CAAP;;;IAGIC;;;;;;;;;;;;;wCACiBK,UAAUN,SAAS;UAClCO,QAAQ,CAACD,QAAD,CAAZ,EAAwB;YAChBE,KAAK,GAAGF,QAAQ,CAACG,SAAT,EAAd;YACMC,GAAG,GAAG,CAACF,KAAK,CAAC,CAAD,CAAL,GAAWF,QAAQ,CAACK,SAAT,EAAZ,EAAkCH,KAAK,CAAC,CAAD,CAAvC,CAAZ;YACMI,MAAM,GAAGC,SAAS,CAAC,IAAIC,UAAJ,CAAe,CAACN,KAAD,EAAQE,GAAR,CAAf,CAAD,EAA+BV,OAAO,CAACe,iBAAR,IAA6B,KAAKC,wBAAjE,CAAxB;QACAV,QAAQ,GAAGW,qBAAqB,CAC9BC,cAAc,CACZZ,QAAQ,CAACG,SAAT,EADY,EAEZT,OAAO,CAACe,iBAAR,IAA6B,KAAKC,wBAFtB,EAGZG,SAHY,CADgB,EAM9BP,MAN8B,CAAhC;QAQAZ,OAAO,CAACe,iBAAR,GAA4BI,SAA5B;;;8FAE+Bb,QAAjC,EAA2CN,OAA3C;;;;uCAGkBoB,SAASpB,SAAS;UAC9BqB,MAAM;;;gBACF;OADV;UAGMC,EAAE,GAAGF,OAAO,CAACG,KAAR,EAAX;;UACID,EAAE,KAAKE,SAAX,EAAsB;QACpBH,MAAM,CAACC,EAAP,GAAYA,EAAZ;;;UAEIhB,QAAQ,GAAGc,OAAO,CAACK,WAAR,EAAjB;;UACInB,QAAJ,EAAc;QACZe,MAAM,CAACf,QAAP,GAAkB,KAAKoB,mBAAL,CAAyBpB,QAAzB,EAAmCN,OAAnC,CAAlB;OADF,MAEO;QACLqB,MAAM,CAACf,QAAP,GAAkB,IAAlB;;;UAEIqB,UAAU,GAAGP,OAAO,CAACQ,aAAR,EAAnB;aACOD,UAAU,CAACP,OAAO,CAACS,eAAR,EAAD,CAAjB;;UACI,CAACC,OAAO,CAACH,UAAD,CAAZ,EAA0B;QACxBN,MAAM,CAACM,UAAP,GAAoBA,UAApB;OADF,MAEO;QACLN,MAAM,CAACM,UAAP,GAAoB,IAApB;;;aAEKN,MAAP;;;;;EAxCkBU;;;;"}