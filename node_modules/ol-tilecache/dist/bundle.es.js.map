{"version":3,"file":"bundle.es.js","sources":["../src/util.js","../src/tile-range.js","../src/tile-url-function.js","../src/index.js"],"sourcesContent":["/**\n * This file is part of ol-tilecache package.\n * @module ol-tilecache\n * @license MIT\n * @author Vladimir Vershinin\n */\n\n/**\n * Left zero pad.\n *\n * @param {string | number} num\n * @param {number} places\n * @returns {string}\n */\nexport function zeroPad (num, places) {\n  const zero = places - num.toString().length + 1\n\n  return (new Array(parseInt(zero > 0 && zero, 10)).join(\"0\") + num)\n    .toString()\n    .slice(-places)\n}\n\n/**\n * The % operator in JavaScript returns the remainder of a / b, but differs from\n * some other languages in that the result will have the same sign as the\n * dividend. For example, -1 % 8 == -1, whereas in some other languages\n * (such as Python) the result would be 7. This function emulates the more\n * correct modulo behavior, which is useful for certain applications such as\n * calculating an offset index in a circular list.\n *\n * @param {number} a The dividend.\n * @param {number} b The divisor.\n * @return {number} a % b where the result is between 0 and b (either 0 <= x < b\n *     or b < x <= 0, depending on the sign of b).\n * @link https://closure-library.googlecode.com/git-history/docs/local_closure_goog_math_math.js.source.html#line73\n */\nexport function modulo (a, b) {\n  const m = a % b\n\n  return (m * b) < 0 ? m + b : m\n}\n\n/**\n * @param {*} value\n * @param {string} [message]\n * @throws {Error} Throws on false value\n */\nexport function assert (value, message = 'Assertion failed') {\n  if (!value) {\n    throw new Error(message)\n  }\n}\n\nexport function isArray (value) {\n  return Object.prototype.toString.call(value) === '[object Array]'\n}\n","/**\n * This file is part of ol-tilecache package.\n * @module ol-tilecache\n * @license MIT\n * @author Vladimir Vershinin\n */\nimport { isArray } from './util'\n/**\n * @param {TileGrid} tileGrid\n * @param {number[]} extent\n * @param {number} z\n * @return {{minX, minY, maxX, maxY}}\n */\nexport function calculateTileRangeForZ (tileGrid, extent, z) {\n  const resolution = tileGrid.getResolution(z)\n  const [ minX, minY ] = getTileCoordForXYAndResolution(tileGrid, extent[ 0 ], extent[ 1 ], resolution, false)\n  const [ maxX, maxY ] = getTileCoordForXYAndResolution(tileGrid, extent[ 2 ], extent[ 3 ], resolution, true)\n\n  return { minX, minY, maxX, maxY }\n}\n\n/**\n * @param {TileGrid} tileGrid\n * @param {number} x\n * @param {number} y\n * @param {number} resolution\n * @param {boolean} reverseIntersectionPolicy\n * @return {number[]}\n */\nexport function getTileCoordForXYAndResolution (tileGrid, x, y, resolution, reverseIntersectionPolicy) {\n  const z = tileGrid.getZForResolution(resolution)\n  const scale = resolution / tileGrid.getResolution(z)\n  const origin = tileGrid.getOrigin(z)\n  let tileSize = tileGrid.getTileSize(z)\n\n  if (!isArray(tileSize)) {\n    tileSize = [ tileSize, tileSize ]\n  }\n\n  const adjustX = reverseIntersectionPolicy ? 0.5 : 0\n  const adjustY = reverseIntersectionPolicy ? 0 : 0.5\n  const xFromOrigin = Math.floor((x - origin[ 0 ]) / resolution + adjustX)\n  const yFromOrigin = Math.floor((y - origin[ 1 ]) / resolution + adjustY)\n  let tileCoordX = scale * xFromOrigin / tileSize[ 0 ]\n  let tileCoordY = scale * yFromOrigin / tileSize[ 1 ]\n\n  if (reverseIntersectionPolicy) {\n    tileCoordX = Math.ceil(tileCoordX) - 1\n    tileCoordY = Math.ceil(tileCoordY) - 1\n  } else {\n    tileCoordX = Math.floor(tileCoordX)\n    tileCoordY = Math.floor(tileCoordY)\n  }\n\n  return [ tileCoordX, tileCoordY ]\n}\n\n/**\n * @param {{minX, minY, maxX, maxY}} tileRange\n * @return {number}\n */\nexport function getTileRangeHeight (tileRange) {\n  return tileRange.maxY - tileRange.minY + 1\n}\n","/**\n * This file is part of ol-tilecache package.\n * @module ol-tilecache\n * @license MIT\n * @author Vladimir Vershinin\n */\nimport {createXYZ} from 'ol/tilegrid'\nimport { zeroPad, modulo } from './util'\nimport { calculateTileRangeForZ, getTileRangeHeight } from './tile-range'\n\nconst zRegEx = /{z}/g\nconst zPadRegEx = /{0z}/g\nconst xRegEx = /{x\\d?}/g\nconst yRegEx = /{y\\d?}/g\nconst dashYRegEx = /{-y\\d?}/g\n\nconst EPSG3857_EXTENT = [\n  -20037508.342789244,\n  -20037508.342789244,\n  20037508.342789244,\n  20037508.342789244\n]\n\n/**\n * Basic create factory.\n *\n * @param {string} url Url template\n * @param {TileGrid} [tileGrid] Tile grid.\n * @param {Extent|number[]} [extent] Tile grid extent.\n * @returns {function(tileCoord: TileCoord)}\n * @static\n * @public\n */\nexport function createTileUrlFunction (url, tileGrid = createXYZ(), extent = EPSG3857_EXTENT) {\n  return createTileUrlFunctionFromTemplates(expandUrl(url), tileGrid, extent)\n}\n\n/**\n * Creates tile URL function from single template.\n *\n * @param {string} template Source url\n * @param {TileGrid} [tileGrid] Tile grid.\n * @param {Extent|number[]} [extent] Tile grid extent.\n * @returns {function(tileCoord: TileCoord)}\n * @private\n */\nexport function createTileUrlFunctionFromTemplate (template, tileGrid = createXYZ(), extent = EPSG3857_EXTENT) {\n  return (\n    /**\n     * @param {TileCoord} tileCoord Tile Coordinate.\n     * @return {string | undefined} Tile URL.\n     */\n      function (tileCoord) {\n      if (tileCoord != null) {\n        return template.replace(zRegEx, zoomReplacer(tileCoord[ 0 ]))\n          .replace(zPadRegEx, zoomReplacer(tileCoord[ 0 ], true))\n          .replace(xRegEx, coordReplacer(tileCoord[ 1 ]))\n          .replace(yRegEx, function (part) {\n            const y = -tileCoord[ 2 ] - 1\n\n            return coordReplacer(y)(part)\n          })\n          .replace(dashYRegEx, function (part) {\n            const z = tileCoord[ 0 ]\n            // The {-y} placeholder requires a tile grid with extent\n            const range = calculateTileRangeForZ(tileGrid, extent, z)\n            const y = getTileRangeHeight(range) + tileCoord[ 2 ]\n\n            return coordReplacer(y)(part)\n          })\n      }\n    })\n}\n\n/**\n * Creates tile URL function from multiple templates.\n *\n * @param {string[]} templates Url templates\n * @param {TileGrid} [tileGrid] Tile grid.\n * @param {Extent | number[]} [extent] Tile grid extent.\n * @returns {function(tileCoord: TileCoord)}\n * @private\n */\nexport function createTileUrlFunctionFromTemplates (templates, tileGrid = createXYZ(), extent = EPSG3857_EXTENT) {\n  return createTileUrlFunctionFromTileUrlFunctions(\n    templates.map(tileUrlFunction => createTileUrlFunctionFromTemplate(tileUrlFunction, tileGrid, extent))\n  )\n}\n\n/**\n * @param zoom\n * @param pad\n * @returns {function}\n * @private\n */\nfunction zoomReplacer (zoom, pad) {\n  return function () {\n    return pad ? zeroPad(zoom, 2) : zoom.toString()\n  }\n}\n\n/**\n * @param coord\n * @returns {function}\n * @private\n */\nfunction coordReplacer (coord) {\n  return function (part) {\n    const match = part.match(/\\d/)\n\n    if (match) {\n      return zeroPad(coord, 9).slice((match[ 0 ] - 1) * 3, match[ 0 ] * 3)\n    }\n\n    return coord.toString()\n  }\n}\n\n/**\n * @param {string} url\n * @returns {Array.<string>}\n * @private\n */\nfunction expandUrl (url) {\n  const urls = []\n  const match = /{(\\d)-(\\d)}/.exec(url) ||\n                /{([a-z])-([a-z])}/.exec(url)\n\n  if (match) {\n    const startCharCode = match[ 1 ].charCodeAt(0)\n    const stopCharCode = match[ 2 ].charCodeAt(0)\n\n    for (let charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      urls.push(url.replace(match[ 0 ], String.fromCharCode(charCode)))\n    }\n  } else {\n    urls.push(url)\n  }\n\n  return urls\n}\n\n/**\n * @param {Array.<function(tileCoord: TileCoord)>} tileUrlFunctions\n * @returns {function(tileCoord: TileCoord)}\n * @private\n */\nfunction createTileUrlFunctionFromTileUrlFunctions (tileUrlFunctions) {\n  if (tileUrlFunctions.length === 1) {\n    return tileUrlFunctions[ 0 ]\n  }\n\n  return (\n    /**\n     * @param {TileCoord} tileCoord Tile Coordinate.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {Projection} projection Projection.\n     * @return {string | undefined} Tile URL.\n     */\n      function (tileCoord, pixelRatio, projection) {\n      if (tileCoord != null) {\n        const h = (tileCoord[ 1 ] << tileCoord[ 0 ]) + tileCoord[ 2 ]\n        const index = modulo(h, tileUrlFunctions.length)\n\n        return tileUrlFunctions[ index ](tileCoord, pixelRatio, projection)\n      }\n    })\n}\n","/**\n * This file is part of ol-tilecache package.\n * @module ol-tilecache\n * @license MIT\n * @author Vladimir Vershinin\n */\nimport {\n  createTileUrlFunction,\n  createTileUrlFunctionFromTemplate,\n  createTileUrlFunctionFromTemplates\n} from './tile-url-function'\n\nexport {\n  createTileUrlFunction,\n  createTileUrlFunctionFromTemplate,\n  createTileUrlFunctionFromTemplates\n}\n\n// for backward compatibility\nif (typeof window !== 'undefined' && window.ol) {\n  window.ol.tileCacheUrlFn = {\n    createTileUrlFunction,\n    createTileUrlFunctionFromTemplate,\n    createTileUrlFunctionFromTemplates,\n  }\n}\n"],"names":["zeroPad","num","places","zero","toString","length","Array","parseInt","join","slice","modulo","a","b","m","isArray","value","Object","prototype","call","calculateTileRangeForZ","tileGrid","extent","z","resolution","getResolution","getTileCoordForXYAndResolution","minX","minY","maxX","maxY","x","y","reverseIntersectionPolicy","getZForResolution","scale","origin","getOrigin","tileSize","getTileSize","adjustX","adjustY","xFromOrigin","Math","floor","yFromOrigin","tileCoordX","tileCoordY","ceil","getTileRangeHeight","tileRange","zRegEx","zPadRegEx","xRegEx","yRegEx","dashYRegEx","EPSG3857_EXTENT","createTileUrlFunction","url","createXYZ","createTileUrlFunctionFromTemplates","expandUrl","createTileUrlFunctionFromTemplate","template","tileCoord","replace","zoomReplacer","coordReplacer","part","range","templates","createTileUrlFunctionFromTileUrlFunctions","map","tileUrlFunction","zoom","pad","coord","match","urls","exec","startCharCode","charCodeAt","stopCharCode","charCode","push","String","fromCharCode","tileUrlFunctions","pixelRatio","projection","h","index","window","ol","tileCacheUrlFn"],"mappings":"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"}